# MCP-002: MCPツール拡充

## 目的
Phase 1で追加される機能（テンプレート・プリセット・装飾等）をMCPツールとして公開し、
Claude CodeからPhase 1の全機能を操作可能にする。

## 対象パッケージ
- `packages/mcp`

## 推奨ブランチ
- `feat/mcp-002-tool-expansion`

## 現状
- MCPサーバー実装済み（`packages/mcp/`）
- 基本ツール: テキストレイヤー作成、レイヤースタイル適用、背景設定、スナップショット取得、エクスポート等
- **Wave 6-7の新機能に対応するツールは未追加**

## 編集可能ファイル
- `packages/mcp/src/tools.ts` — 新規ツール定義追加
- `packages/mcp/src/__tests__/` — テスト追加

## 編集禁止ファイル
- `packages/mcp/src/bridge.ts`（既存のブリッジロジックは変更しない）
- `packages/mcp/src/index.ts`（エントリポイントは必要最小限の変更のみ）
- `packages/app/` 配下全て
- `packages/render/` 配下全て
- `packages/core/` 配下全て

## 実装要件（Must）
1. **テンプレート操作ツール**
   - `list_templates()` — テンプレート一覧取得
   - `load_template(templateId)` — テンプレートを読み込んで新規ドキュメント作成
   - `save_as_template(name)` — 現在のドキュメントをテンプレート保存
   - `create_from_preset(presetName)` — プリセットサイズ（YouTube 1280x720等）で新規作成

2. **テキストスタイルプリセットツール**
   - `list_text_presets()` — テキストスタイルプリセット一覧
   - `apply_text_preset(layerId, presetId)` — プリセットをテキストレイヤーに適用

3. **装飾ツール**
   - `add_concentration_lines(config)` — 集中線追加
   - `apply_gradient_mask(layerId, config)` — グラデーションマスク適用
   - `set_pattern_background(patternType, config)` — パターン背景設定

4. **クリッピングマスクツール**
   - `set_clipping_mask(layerId, enabled)` — クリッピングマスクのトグル

5. **スタイル分析ツール**
   - `describe_layer_style(layerId)` — レイヤーのスタイルを自然言語で記述
   - `apply_style_description(layerId, description)` — 自然言語でスタイルを適用

## 実装要件（Should）
1. 各ツールの入力バリデーション（存在しないlayerId等のエラーハンドリング）
2. ツールのグループ化（template / preset / decoration / style）

## 受け入れ基準
1. 全ツールがMCPプロトコル経由で呼び出せる
2. 各ツールが正しい結果を返す（or 適切なエラーメッセージ）
3. 既存のMCPツールに回帰がない

## 必須テスト
- 各ツールのユニットテスト
- エラーケース（不正なID、不正なパラメータ）のテスト
- 既存ツールの回帰テスト

## 実行コマンド
- `pnpm --filter @photoshop-app/mcp test`
- `pnpm lint`

## 備考
このチケットはWave 6-7の機能が完成した後、それらをMCP経由で公開するもの。
機能側のAPIが確定してから着手するのが効率的。
ただし、ツール定義のスケルトン（引数定義・型定義）は先行して作成可能。
